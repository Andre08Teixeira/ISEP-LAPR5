%entrega(<idEntrega>,<data>,<massaEntrefa>,<armazemEntrega>,<tempoColoc>,<tempoRet>)

entrega(4439,20221205,200,1,8,10).
entrega(4438,20221205,150,9,7,9).
entrega(4445, 20221205, 100, 3, 5, 7).
entrega(4443, 20221205, 120, 8, 6, 8).
entrega(4449, 20221205, 300, 11, 15, 20).
entrega(4398, 20221205, 310, 17, 16, 20).
entrega(4432, 20221205, 270, 14, 14, 18).
entrega(4437, 20221205, 180, 12, 9, 11).
entrega(4451, 20221205, 220, 6, 9, 12).
entrega(4452, 20221205, 390, 13, 21, 26).
entrega(4444, 20221205, 380, 2, 20, 25).
entrega(4455, 20221205, 280, 7, 14, 19).
entrega(4399, 20221205, 260, 15, 13, 18).
entrega(4454, 20221205, 350, 10, 18, 22).
entrega(4446, 20221205, 260, 4, 14, 17).
entrega(4456, 20221205, 330, 16, 17, 21).



%idArmazem(<local>,<codigo>)
idArmazem('Arouca',1).
idArmazem('Espinho',2).
idArmazem('Gondomar',3).
idArmazem('Maia',4).
idArmazem('Matosinhos',5).
idArmazem('Oliveira de Azemeis',6).
idArmazem('Paredes',7).
idArmazem('Porto',8).
idArmazem('Povoa de Varzim',9).
idArmazem('Santa Maria da Feira',10).
idArmazem('Santo Tirso',11).
idArmazem('Sao Joao da Madeira',12).
idArmazem('Trofa',13).
idArmazem('Vale de Cambra',14).
idArmazem('Valongo',15).
idArmazem('Vila do Conde',16).
idArmazem('Vila Nova de Gaia',17).

distancia(1,2,53).
distancia(1,3,57).
distancia(1,4,67).
distancia(1,5,65).
distancia(1,6,30).
distancia(1,7,44).
distancia(1,8,57).
distancia(1,9,92).
distancia(1,10,37).
distancia(1,11,80).
distancia(1,12,29).
distancia(1,13,83).
distancia(1,14,22).
distancia(1,15,64).
distancia(1,16,85).
distancia(1,17,56).

distancia(2,1,52).
distancia(2,3,28).
distancia(2,4,31).
distancia(2,5,27).
distancia(2,6,34).
distancia(2,7,48).
distancia(2,8,22).
distancia(2,9,55).
distancia(2,10,17).
distancia(2,11,51).
distancia(2,12,24).
distancia(2,13,53).
distancia(2,14,43).
distancia(2,15,37).
distancia(2,16,47).
distancia(2,17,18).

distancia(3,1,56).
distancia(3,2,28).
distancia(3,4,19).
distancia(3,5,18).
distancia(3,6,46).
distancia(3,7,29).
distancia(3,8,10).
distancia(3,9,45).
distancia(3,10,35).
distancia(3,11,34).
distancia(3,12,40).
distancia(3,13,36).
distancia(3,14,47).
distancia(3,15,10).
distancia(3,16,38).
distancia(3,17,13).

distancia(4,1,68).
distancia(4,2,30).
distancia(4,3,20).
distancia(4,5,12).
distancia(4,6,59).
distancia(4,7,34).
distancia(4,8,12).
distancia(4,9,32).
distancia(4,10,43).
distancia(4,11,24).
distancia(4,12,52).
distancia(4,13,14).
distancia(4,14,60).
distancia(4,15,16).
distancia(4,16,18).
distancia(4,17,14).

distancia(5,1,64).
distancia(5,2,25).
distancia(5,3,18).
distancia(5,4,11).
distancia(5,6,55).
distancia(5,7,35).
distancia(5,8,9).
distancia(5,9,30).
distancia(5,10,37).
distancia(5,11,32).
distancia(5,12,45).
distancia(5,13,25).
distancia(5,14,56).
distancia(5,15,18).
distancia(5,16,23).
distancia(5,17,9).

distancia(6,1,29).
distancia(6,2,34).
distancia(6,3,47).
distancia(6,4,58).
distancia(6,5,55).
distancia(6,7,60).
distancia(6,8,48).
distancia(6,9,83).
distancia(6,10,18).
distancia(6,11,70).
distancia(6,12,11).
distancia(6,13,73).
distancia(6,14,11).
distancia(6,15,55).
distancia(6,16,75).
distancia(6,17,47).

distancia(7,1,45).
distancia(7,2,48).
distancia(7,3,28).
distancia(7,4,32).
distancia(7,5,35).
distancia(7,6,60).
distancia(7,8,33).
distancia(7,9,60).
distancia(7,10,55).
distancia(7,11,28).
distancia(7,12,53).
distancia(7,13,39).
distancia(7,14,61).
distancia(7,15,20).
distancia(7,16,52).
distancia(7,17,38).

distancia(8,1,58).
distancia(8,2,23).
distancia(8,3,8).
distancia(8,4,12).
distancia(8,5,9).
distancia(8,6,48).
distancia(8,7,32).
distancia(8,9,37).
distancia(8,10,32).
distancia(8,11,28).
distancia(8,12,42).
distancia(8,13,30).
distancia(8,14,50).
distancia(8,15,15).
distancia(8,16,29).
distancia(8,17,7).

distancia(9,1,90).
distancia(9,2,51).
distancia(9,3,44).
distancia(9,4,30).
distancia(9,5,29).
distancia(9,6,81).
distancia(9,7,59).
distancia(9,8,35).
distancia(9,10,64).
distancia(9,11,36).
distancia(9,12,71).
distancia(9,13,24).
distancia(9,14,82).
distancia(9,15,42).
distancia(9,16,4).
distancia(9,17,35).

distancia(10,1,37).
distancia(10,2,17).
distancia(10,3,34).
distancia(10,4,41).
distancia(10,5,38).
distancia(10,6,18).
distancia(10,7,53).
distancia(10,8,30).
distancia(10,9,65).
distancia(10,11,57).
distancia(10,12,8).
distancia(10,13,58).
distancia(10,14,21).
distancia(10,15,43).
distancia(10,16,57).
distancia(10,17,29).

% c:/Users/joaop/Ambiente de Trabalho/projeto/lapr5_41/Planeamento/Heuristicaaa.pl compiled 0.00 sec, 321 clauses

distancia(11,1,81).
distancia(11,2,51).
distancia(11,3,35).
distancia(11,4,22).
distancia(11,5,31).
distancia(11,6,71).
distancia(11,7,29).
distancia(11,8,29).
distancia(11,9,35).
distancia(11,10,57).
distancia(11,12,65).
distancia(11,13,9).
distancia(11,14,73).
distancia(11,15,31).
distancia(11,16,34).
distancia(11,17,34).

distancia(12,1,29).
distancia(12,2,24).
distancia(12,3,40).
distancia(12,4,51).
distancia(12,5,48).
distancia(12,6,10).
distancia(12,7,53).
distancia(12,8,41).
distancia(12,9,76).
distancia(12,10,8).
distancia(12,11,63).
distancia(12,13,66).
distancia(12,14,13).
distancia(12,15,48).
distancia(12,16,68).
distancia(12,17,40).

distancia(13,1,81).
distancia(13,2,44).
distancia(13,3,36).
distancia(13,4,14).
distancia(13,5,25).
distancia(13,6,71).
distancia(13,7,38).
distancia(13,8,25).
distancia(13,9,25).
distancia(13,10,59).
distancia(13,11,9).
distancia(13,12,65).
distancia(13,14,73).
distancia(13,15,21).
distancia(13,16,19).
distancia(13,17,27).

distancia(14,1,22).
distancia(14,2,44).
distancia(14,3,48).
distancia(14,4,58).
distancia(14,5,56).
distancia(14,6,11).
distancia(14,7,60).
distancia(14,8,48).
distancia(14,9,83).
distancia(14,10,21).
distancia(14,11,71).
distancia(14,12,13).
distancia(14,13,73).
distancia(14,15,55).
distancia(14,16,76).
distancia(14,17,47).

distancia(15,1,64).
distancia(15,2,37).
distancia(15,3,10).
distancia(15,4,15).
distancia(15,5,18).
distancia(15,6,55).
distancia(15,7,20).
distancia(15,8,16).
distancia(15,9,44).
distancia(15,10,45).
distancia(15,11,31).
distancia(15,12,48).
distancia(15,13,22).
distancia(15,14,56).
distancia(15,16,36).
distancia(15,17,21).

distancia(16,1,85).
distancia(16,2,46).
distancia(16,3,39).
distancia(16,4,20).
distancia(16,5,23).
distancia(16,6,75).
distancia(16,7,53).
distancia(16,8,29).
distancia(16,9,4).
distancia(16,10,58).
distancia(16,11,35).
distancia(16,12,65).
distancia(16,13,19).
distancia(16,14,76).
distancia(16,15,36).
distancia(16,17,30).

distancia(17,1,57).
distancia(17,2,18).
distancia(17,3,14).
distancia(17,4,16).
distancia(17,5,12).
distancia(17,6,47).
distancia(17,7,38).
distancia(17,8,8).
distancia(17,9,39).
distancia(17,10,30).
distancia(17,11,36).
distancia(17,12,37).
distancia(17,13,29).
distancia(17,14,48).
distancia(17,15,22).
distancia(17,16,31).

%carateristicasCam(<nome_camiao>,<tara>,<capacidade_carga>,<carga_total_baterias>,<autonomia>,<t_recarr_bat_20a80>).
carateristicasCam(eTruck01,7500,4300,80,100,60).
carateristicasCam(eTruck02,7500,4300,80,100,60).
carateristicasCam(eTruck03,7500,4300,80,100,60).

heuristica(X,L,Data):-
    get_time(A),
    findall(M,entrega(_,Data,_,M,_,_),ListaAll),
    calculo_heuristica(X,ListaAll,L1),
    append(L1,[X],L),
    get_time(B),
    C is B-A.


calculo_heuristica(_,[],[]).
calculo_heuristica(X,ListaAux,[X|Trajeto]):-
    caminhoInit(X,ListaAux,Z),
    member(Z,ListaAux),
    delete(ListaAux,Z,ListaAux1),
    calculo_heuristica(Z,ListaAux1,Trajeto).


%verificarTrajeto(Trajeto,Lista,M,Z):-
% (delete(Lista,M,Lista),list_min(Lista,M1));verificarTrajeto(Trajeto,Lista,M,Z).
%


caminhoInit(Inicio,[C1|T],DestinoMaisPequeno):-Menor is 100000, caminhoPequeno(Inicio,[C1|T],_,Menor,DestinoMaisPequeno).

caminhoPequeno(_,[],DestinoMaisPequeno,_,DestinoMaisPequeno):-!.
caminhoPequeno(Inicio,[C1|T],_,MenorTemp,DestinoMaisPequenoTemp):-distancia(Inicio,C1,R), R<MenorTemp,!,
    caminhoPequeno(Inicio,T,C1,R,DestinoMaisPequenoTemp).

caminhoPequeno(Inicio,[_|T],DestinoMaisPequeno,MenorTemp,DestinoMaisPequenoTemp):-caminhoPequeno(Inicio,T,DestinoMaisPequeno,MenorTemp,DestinoMaisPequenoTemp).



list_min([L|Ls], Min) :-
    list_min(Ls, L, Min).

list_min([], Min, Min).
list_min([L|Ls], Min0, Min) :-
    Min1 is min(L, Min0),
    list_min(Ls, Min1, Min).



%heuristicaMaiorMassa PI=PontoInicial

heuristicaMaiorMassa(PI,Data,L):-
    get_time(A),
    findall(Massa,entrega(_,Data,Massa,_,_,_),ListaAll),
    entrega(_,_,M,PI,_,_),
    delete(ListaAll,M,ListaAll1)
    ,calculo_heuristica1(PI,ListaAll1,L1),
    append(L1,[PI],L),
    get_time(B),
    C is B-A.


calculo_heuristica1(_,[],[]).
calculo_heuristica1(PI,ListaAux,[PI|Trajeto]):- caminhoMaiorCarga(ListaAux,M),
    entrega(_,_,M,D,_,_),
    delete(ListaAux,M,ListaAux1), calculo_heuristica1(D,ListaAux1,Trajeto).



caminhoMaiorCarga([],0):-!.
caminhoMaiorCarga([Massa|T],MaiorCarga):- caminhoMaiorCarga(T,MaiorCarga1),
    ((Massa>MaiorCarga1,!,MaiorCarga is Massa);
    (MaiorCarga is MaiorCarga1)).


procurarEntregas(Data,List):-findall(M,entrega(_,Data,_,M,_,_),List).




%HeuristicaMaiorRacioMassaDistancia PI=PontoInicial

%heuristicaMaiorRacio(PI,Data,L):-findall(Armazem,entrega(_,Data,_,Armazem,_,_),ListaAll),encontrarRacio(PI,ListaAll,ListaDestinos),append(ListaDestinos,PI,L).

%encontrarRacio(,[],[]):-!.
%encontrarRacio(O,LA,[O|LD]):-caminhoMaiorRacio(O,LA,0,D),delete(LA,D,LA1),encontrarRacio(D,LA1,LD).



%caminhoMaiorRacio(_,[X],_,X):-!.
%caminhoMaiorRacio(PI,[X|LA],R,D):- distancia(PI,X,Dist),entrega(_,_,M,X,_,_),R is (M/Dist),D is X,caminhoMaiorRacio(PI,LA,R1,D1),(R<R1,!,R is R1,D is D1).

%id_para_nome
id_para_nome([],[]):-!.
id_para_nome([HF|LF],LN):- idArmazem(N,HF),
    id_para_nome(LF,TN),
    LN = [N|TN].

inverter([],[]):-!.
inverter([H|T],R):-inverter(T,R1), append(R1,[H],R).
listaCamiao(X):- findall(D,carateristicasCam(D,_,_,_,_,_),X).
listaEntregas(X):- findall(D,entrega(D,_,_,_,_,_),X).


:- dynamic planeamento/2.

atribuir(RESTO,C,E,L):-retractall(planeamento(_,_)),atribuirResto(RESTO,C,E,L),findall(planeamento(X,A),
planeamento(X,A),PIROCA),write(PIROCA).

atribuirResto(0,X,T,T):-!.
atribuirResto(Resto,[HC|TC],[H|T],ListaNovaEntrega):-assertz(planeamento(HC,H)),
Resto1 is Resto-1,atribuirResto(Resto1,TC,T,ListaNovaEntrega)
.

atribuirMerdas([],T,T):-!.
atribuirMerdas([HC|TC],[HE |TE],ENOVA):-asserta(planeamento(HC,HE)), atribuirMerdas(TC,TE,ENOVA).

recursaoCamiao(_,[]):-!.
recursaoCamiao(C,E):-atribuirMerdas(C,E,ENOVA2),inverter(ENOVA2,ENOVA),recursaoCamiao(C,ENOVA).

camiaoEntregas(PIROCA):-retractall(planeamento(_,_)),
listaCamiao(C),
obterTamanhoLista(C,TAMANHOC),
listaEntregas(E),
obterTamanhoLista(E,TAMANHOE),
obterResto(TAMANHOE,TAMANHOC,RESTO),
atribuirResto(RESTO,C,E,ListaNovaEntrega),
recursaoCamiao(C,ListaNovaEntrega),
findall(planeamento(X,A),
planeamento(X,A),PIROCA).

obterTamanhoLista([],0).
obterTamanhoLista([_|T],R):-obterTamanhoLista(T,Tamanho),R is Tamanho+1.

obterResto(E,C,RESTO):-RESTO is (E mod C).






